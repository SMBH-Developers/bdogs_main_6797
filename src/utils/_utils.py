from datetime import datetime, timedelta

from pyrogram import types


__all__ = ["get_date_by_weekday", "extract_card_from_command"]


def get_date_by_weekday(day: str):
    days = {'–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': 0, '–≤—Ç–æ—Ä–Ω–∏–∫': 1, '—Å—Ä–µ–¥–∞': 2,
            '—á–µ—Ç–≤–µ—Ä–≥': 3, '–ø—è—Ç–Ω–∏—Ü–∞': 4, '—Å—É–±–±–æ—Ç–∞': 5, '–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ': 6}

    today = datetime.now()

    target_weekday = days[day.lower()]
    days_ahead = (target_weekday - today.weekday())

    day_date = today + timedelta(days=days_ahead)
    return day_date


async def extract_card_from_command(message: types.Message) -> str | None:
    if len(message.command) < 2:
        await message.reply('–û—à–∏–±–∫–∞: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ãüí≥.')
        return

    card = message.command[1] if len(message.command) == 2 else ' '.join(message.command[1:])

    if not card.replace(' ', '').isdigit() or 16 < len(card) > 19:
        await message.reply("–û—à–∏–±–∫–∞: –∫–∞—Ä—Ç–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ 16 —Ü–∏—Ñ—Ä.")
        return

    return card
